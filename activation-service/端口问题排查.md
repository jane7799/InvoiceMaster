# 端口访问问题排查

## 问题：6300端口无法访问

### 可能原因和解决方案

#### 1. 检查Docker端口映射

在NAS的Docker界面查看：
1. **容器** → 选择 `invoice-activation`
2. **详情** → **端口设置**
3. 确认是否显示：`6300 → 5000`

**如果没有端口映射：**
- 停止容器
- 编辑项目
- 在docker-compose.yml中确认：
  ```yaml
  ports:
    - "6300:5000"
  ```
- 重新启动

#### 2. 检查NAS防火墙

**群晖NAS：**
1. **控制面板** → **安全性** → **防火墙**
2. 检查是否启用了防火墙
3. 如果启用，添加规则：
   - 端口：6300
   - 协议：TCP
   - 来源IP：允许所有（或指定局域网）

**威联通NAS：**
1. **控制台** → **系统** → **安全**
2. **防火墙** → 添加规则允许6300端口

#### 3. 尝试其他端口

如果6300被占用，修改为其他端口：

编辑 `docker-compose.yml`：
```yaml
ports:
  - "8080:5000"  # 改为8080
```

然后重启容器。

#### 4. 使用容器IP直接访问（测试用）

从日志看到容器IP是 `172.29.0.2`

尝试访问：
```
http://172.29.0.2:5000
```

如果这个能访问，说明应用正常，问题在端口映射。

#### 5. 检查容器状态

在Docker界面确认：
- 容器状态：**正在运行**
- 健康状态：**健康**（如果显示）

#### 6. 查看完整日志

在Docker界面：
1. **容器** → `invoice-activation`
2. **详情** → **日志**
3. 查看是否有错误信息

### 快速测试步骤

1. **测试容器内部**
   - 如果能访问 `http://172.29.0.2:5000`
   - 说明应用正常，是端口映射问题

2. **测试端口映射**
   ```
   http://NAS的IP:6300
   ```

3. **测试防火墙**
   - 临时关闭NAS防火墙测试
   - 如果能访问，说明是防火墙问题

### 推荐解决方案

**方案1：使用常用端口**
改用8080或8000等常用端口：
```yaml
ports:
  - "8080:5000"
```

**方案2：检查端口占用**
在NAS上检查6300是否被其他服务占用

**方案3：重建容器**
1. 停止并删除容器
2. 删除项目
3. 重新创建项目

### 需要提供的信息

如果以上方法都不行，请提供：
1. NAS型号和系统版本
2. Docker容器的完整日志
3. 端口设置截图
4. 能否访问 `http://172.29.0.2:5000`
