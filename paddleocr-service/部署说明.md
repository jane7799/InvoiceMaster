# PaddleOCR 私有服务部署指南

## 📋 部署到飞牛NAS

### 1. 上传文件
将 `paddleocr-service` 整个文件夹上传到NAS，例如：
```
/vol1/1000/tools/paddleocr-service/
```

### 2. SSH登录NAS并构建
```bash
cd /vol1/1000/tools/paddleocr-service
docker-compose up -d --build
```

### 3. 验证服务
```bash
curl http://localhost:8891/health
# 应返回: {"service":"PaddleOCR Invoice API","status":"ok"}
```

---

## 🌐 配置Cloudflare反代（IPv6转IPv4）

### 1. 添加DNS记录
在Cloudflare控制台添加AAAA记录：
- 类型: `AAAA`
- 名称: `ocr` (或其他子域名)
- IPv6地址: 您的NAS IPv6地址
- 代理状态: 开启（橙色云朵）

### 2. 配置Cloudflare Tunnel（推荐）
如果直接AAAA记录不稳定，可使用Zero Trust Tunnel：
1. 安装cloudflared到NAS
2. 创建Tunnel指向 `localhost:8891`
3. 绑定域名 `ocr.yourdomain.com`

### 3. 防火墙设置
确保NAS防火墙开放8891端口（或使用Tunnel则不需要）

---

## 🔧 在软件中配置

在智能发票打印助手的设置中填入：
- **私有OCR地址**: `https://ocr.yourdomain.com`

软件会自动：
1. 优先使用私有OCR服务（免费无限次）
2. 如果私有服务不可用，回退到百度云OCR

---

## 📊 API接口说明

### 健康检查
```
GET /health
返回: {"status": "ok", "service": "PaddleOCR Invoice API"}
```

### 发票识别
```
POST /ocr/invoice
Content-Type: application/json

请求体:
{
    "image": "Base64编码的图片或PDF"
}

返回:
{
    "success": true,
    "code": "发票代码",
    "number": "发票号码",
    "date": "2025-01-01",
    "amount": 1234.56,
    "buyer": "购买方名称",
    "seller": "销售方名称",
    "raw_text": ["识别", "的", "文字", "列表"]
}
```

---

## ⚠️ 注意事项

1. **首次构建较慢**: 需要下载PaddleOCR模型(~500MB)
2. **内存需求**: 建议至少2GB可用内存
3. **CPU要求**: 使用CPU推理，ARM架构NAS可能较慢
4. **全电发票**: 20位发票号码，无发票代码，这是正常的
